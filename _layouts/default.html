<!DOCTYPE html>
<html lang="{{ site.lang | default: 'en' }}">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0f172a">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="{{ '/feed.xml' | relative_url }}">

    {%- seo -%}

    <!-- Favicons (place files in /assets/favicons or /) -->
    <link rel="icon" href="{{ '/favicon.ico' | relative_url }}" sizes="any">
    <link rel="icon" type="image/png" href="{{ '/favicon-32x32.png' | relative_url }}" sizes="32x32">
    <link rel="icon" type="image/png" href="{{ '/favicon-96x96.png' | relative_url }}" sizes="96x96">

    <!-- Fonts (optional: host locally) -->
    <link rel="preload" href="{{ '/assets/fonts/Inter-Regular.woff2' | relative_url }}" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="{{ '/assets/fonts/Roboto-Regular.woff2' | relative_url }}" as="font" type="font/woff2" crossorigin>

    <!-- Styles -->
    <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}">
  </head>
  <body>
    <a class="skip-link" href="#main">Skip to content</a>
    <header class="site-header" role="banner">
      <div class="container">
        <a class="site-title" href="{{ '/' | relative_url }}">{{ site.title }}</a>
        <nav class="site-nav" aria-label="Primary">
          <a href="{{ '/' | relative_url }}"{% if page.url == '/' %} aria-current="page"{% endif %}>Home</a>
          <a href="{{ '/tags/' | relative_url }}"{% if page.url contains '/tags/' %} aria-current="page"{% endif %}>Tags</a>
          <a href="{{ '/about/' | relative_url }}"{% if page.url contains '/about/' %} aria-current="page"{% endif %}>About</a>
          <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">
            <span class="theme-icon">☾</span>
          </button>
        </nav>
      </div>
    </header>

    <main id="main" class="site-main" role="main">
      <div class="container">
        {{ content }}
      </div>
    </main>

    <footer class="site-footer" role="contentinfo">
      <div class="container">
        <p>© {{ site.title }} {{ 'now' | date: '%Y' }} • <a href="{{ '/feed.xml' | relative_url }}">RSS</a></p>
      </div>
    </footer>

    <script>
      // Enhanced dark mode toggle with better persistence and animation
      (function() {
        const root = document.documentElement;
        const themeToggle = document.getElementById('theme-toggle');
        const themeIcon = themeToggle.querySelector('.theme-icon');
        const storageKey = 'crypto-blog-theme';
        
        // Check for saved theme preference or default to 'light'
        const savedTheme = localStorage.getItem(storageKey);
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const currentTheme = savedTheme || (prefersDark ? 'dark' : 'light');
        
        // Apply theme on load
        function applyTheme(theme) {
          if (theme === 'dark') {
            root.classList.add('dark');
            themeIcon.textContent = '☀️';
            themeToggle.setAttribute('aria-label', 'Switch to light mode');
          } else {
            root.classList.remove('dark');
            themeIcon.textContent = '☾';
            themeToggle.setAttribute('aria-label', 'Switch to dark mode');
          }
          localStorage.setItem(storageKey, theme);
        }
        
        // Initialize theme
        applyTheme(currentTheme);
        
        // Toggle theme
        themeToggle.addEventListener('click', function() {
          const isDark = root.classList.contains('dark');
          const newTheme = isDark ? 'light' : 'dark';
          applyTheme(newTheme);
        });
        
        // Listen for system theme changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
          if (!localStorage.getItem(storageKey)) {
            applyTheme(e.matches ? 'dark' : 'light');
          }
        });
      })();
    </script>
  </body>
</html>
